apiVersion: apps/v1
kind: Deployment
metadata:
  name: navidrome
  namespace: navidrome
spec:
  replicas: 1
  selector:
    matchLabels:
      app: navidrome
  template:
    metadata:
      labels:
        app: navidrome
      annotations:
        prometheus.io/scrape: 'true'
        prometheus.io/port: '4533'
    spec:
      containers:
        - name: navidrome
          image: deluan/navidrome:latest
          ports:
            - containerPort: 4533
          env:
            - name: ND_BASEPATH
              value: /navidrome
            - name: ND_DBPATH
              value: /data/navidrome.db
            - name: ND_MUSICFOLDER
              value: /music
            - name: ND_PORT
              value: '4533'
          resources:
            requests:
              memory: '256Mi'
              cpu: '500m'
            limits:
              memory: '512Mi'
              cpu: '1000m'
          livenessProbe:
            httpGet:
              path: /ping
              port: 4533
            initialDelaySeconds: 30
            periodSeconds: 10
          readinessProbe:
            httpGet:
              path: /ping
              port: 4533
            initialDelaySeconds: 10
            periodSeconds: 5
          volumeMounts:
            - name: music
              mountPath: /music
            - name: data
              mountPath: /data
      volumes:
        - name: music
          hostPath:
            # VirtualBox shared folder - adjust path if you mounted it elsewhere
            # Default auto-mount location: /media/sf_music
            # Or if manually mounted: /mnt/windows-music
            path: /media/sf_music
            type: Directory
        - name: data
          hostPath:
            # Store Navidrome database and metadata on the host
            path: /var/lib/navidrome
            type: DirectoryOrCreate
